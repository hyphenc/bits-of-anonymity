<!DOCTYPE HTML>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>bits of anonymity</title>
<style>
#bits {
  font-family: monospace;
  font-size: 1rem;
}
</style>
</head>
<body>
<h1>bits of anonymity</h1>
<p id="bits">AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</p>
<div id="prompt">
<div>
<label for="name">name: </label>
<input type="text" id="p-name" name="name" placeholder="give this de-anonymization a name" required>
</div>
<div>
<label for="bigger-set">bigger set: </label>
<input id="p-bigger-set" value="7900000000" type="numeric" name="bigger-set" placeholder="initially the human population">
</div>
<div>
<label for="smaller-set">smaller set: </label>
<input id="p-smaller-set" type="numeric" name="bigger-set" placeholder="narrows you down to one of X people">
</div>
<button onclick="calc()">submit</button>
</div>

<div id="log"></div>

<script>
const log = document.getElementById("log");
const bigger = document.getElementById("p-bigger-set");
const smaller = document.getElementById("p-smaller-set");
const name = document.getElementById("p-name");
const initialbits = 33; // will suffice for some time

function calc() {
  if(name.value == "" || smaller.value == "" || bigger.value == "") {
    name.reportValidity();
    bigger.reportValidity();
    smaller.reportValidity();
    return;
  }

  had = Math.round(Math.log2(bigger.value));
  diff = had - Math.round(Math.log2(smaller.value));
  now = had - diff;

  if(now == 0) {
    log.insertAdjacentHTML("afterbegin", "<p>you are de-anonymized</p>");
    return;
  }

  str = "<p>you had "+had+" bits of anonymity. "+name.value+" made you lose "+diff+".</p>"
  log.insertAdjacentHTML("afterbegin", str);
  bits.innerHTML = "A".repeat(now).padStart(initialbits, "x");

  bigger.value = smaller.value;
  smaller.value = "";
}


</script>
</body>
</html>

